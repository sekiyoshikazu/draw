var __extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);o.prototype=t.prototype,e.prototype=new o},BG=function(e){function t(t,o,n){void 0===o&&(o=2400),void 0===n&&(n="bgImg"),e.call(this,t),this._baseWidth=o,this._scrollMax=Main.STAGE_WIDTH-o}return __extends(t,e),Object.defineProperty(t.prototype,"scrollMax",{get:function(){return this._scrollMax},set:function(e){this._scrollMax=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseWidth",{get:function(){return this._baseWidth},set:function(e){this._baseWidth=e},enumerable:!0,configurable:!0}),t.prototype._onAdded=function(e){console.log("****************",e.type,e.target)},t}(createjs.Bitmap),__extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);o.prototype=t.prototype,e.prototype=new o},CharacterBase=function(e){function t(){e.call(this),this._hp=1,this._speed=2,this._willDelete=!1,this.addEventListener("hit",this._onHit),this.addEventListener("died",this._onDied)}return __extends(t,e),t.prototype.init=function(){console.log("init",Main.main)},t.prototype.getSprite=function(e){var t=new createjs.SpriteSheet(e),o=new createjs.Sprite(t);return o},t.prototype.move=function(){},t.prototype.shoot=function(){},t.prototype.hitEffect=function(){console.log(this,"hit!!")},t.prototype.dieEffect=function(){console.log(this,"died!!")},Object.defineProperty(t.prototype,"hp",{get:function(){return this._hp},set:function(e){this._hp=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"willDelete",{get:function(){return this._willDelete},enumerable:!0,configurable:!0}),t.prototype._onAdded=function(){alert("_onAdded"),this.init(),this.removeEventListener("added",this._onAdded)},t.prototype._onHit=function(){this._hp=-1,this._hp>=1?this.hitEffect():this.dispatchEvent("died")},t.prototype._onDied=function(){this.hitEffect()},t}(createjs.Container),__extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);o.prototype=t.prototype,e.prototype=new o},EnemyCharacter=function(e){function t(){e.call(this),this._startX=960,this._startY=170,this._hp=1,this._speed=8,this._friendly=!1,console.log("EnemyCharacter"),this.x=960,this.y=0,this._count=this.startY}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),console.log("init","EnemyCharacter"),this.addChild(Main.loadedBitmaps.enemy1.clone())},t.prototype.move=function(){console.log("move",this._willDelete),this._count+=this._speed,this.x-=this._speed,this.y=this.startY+100*Math.sin(.01*this._count)},t.prototype.shoot=function(){Math.atan2(this.y-Main.player.y,this.x-Main.player.x)},Object.defineProperty(t.prototype,"startX",{get:function(){return this._startX},set:function(e){this._startX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startY",{get:function(){return this._startY},set:function(e){this._startY=e},enumerable:!0,configurable:!0}),t}(CharacterBase),__extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);o.prototype=t.prototype,e.prototype=new o},NormalBullet=function(e){function t(){e.call(this),this._alignment=1,this._speed=32,this.x=Main.player.x+110,this.y=Main.player.y+30}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),this.addChild(Main.loadedBitmaps.bullet.clone())},t.prototype.move=function(){e.prototype.move.call(this),this.x+=this._speed,this.x>1e3&&(this._willDelete=!0)},t}(CharacterBase),__extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);o.prototype=t.prototype,e.prototype=new o},PlayerCharacter=function(e){function t(){e.call(this),this._bullet=1,this._multi=0,this._missile=0,this._hp=30,this._speed=2,this._friendly=!0,console.log("PlayerCharacter"),this.x=0,this.y=0}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),console.log("init","PlayerCharacter"),this.addChild(Main.loadedBitmaps.player)},t.prototype.move=function(){Main.pressedKeys[0]&&(this.x-=this._speed),Main.pressedKeys[1]&&(this.y-=this._speed),Main.pressedKeys[2]&&(this.x+=this._speed),Main.pressedKeys[3]&&(this.y+=this._speed)},t.prototype.shoot=function(){console.log("shoot!!");var e=new NormalBullet;Main.stage.addChild(e),e.init(),Main.charas.push(e)},t}(CharacterBase),__extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);o.prototype=t.prototype,e.prototype=new o},Main=function(e){function t(){e.call(this),this._loadQueue=new createjs.LoadQueue,this._manifest=[{id:"clearImg",src:"img/clear.jpg",type:createjs.AbstractLoader.IMAGE}],this._mask=new createjs.Shape,this._filters=[],this._$canvas=$("#canvas"),this._THIKNESS=32,this._MASK_COLOR="#ffffff";var o=this._loadQueue;t.main=this;var n=t.main;createjs.Ticker.framerate=30,t._isVideo="video"==n._manifest[0].type?!0:!1,t.touchEnabled=createjs.Touch.isSupported(),o.addEventListener("fileload",this._onFileLoad),o.addEventListener("complete",this._onFileLoadComplete),o.addEventListener("progress",this._onFileLoadProgress),o.addEventListener("error",this._onFileLoadError),o.loadManifest(this._manifest)}return __extends(t,e),t.prototype.init=function(){if(t.touchEnabled){var e=t.stage;createjs.Touch.enable(e,!0),t.mouseDown="touchstart",t.mouseUp="touchend",t.mouseMove="touchmove"}},t.prototype.clearMask=function(){var e=t.main,o=e._mask.graphics;o.clear(),o.setStrokeStyle(e._THIKNESS,"round","round").beginStroke(e._MASK_COLOR)},t.prototype.drawMask=function(e,o){var n=t.main,i=t.stage,s=n._mask.graphics;n._mask.updateCache(),s.moveTo(n._lastX,n._lastY).lineTo(e,o),n._lastX=e,n._lastY=o,n._mask.updateCache(),n._clear.updateCache(),i.update()},t.prototype.stopDraw=function(){var e=t.main,o=t.stage;e.drawMask(o.mouseX,o.mouseY),o.removeEventListener("mousereave",e._onMouseReave),o.removeEventListener("pressmove",e._onMouseMove),o.removeEventListener("pressup",e._onMouseUp)},t.prototype._onFileLoad=function(e){var o,n=e.item.id,i=t.main;t._isVideo?(i._videoEl=document.createElement("video"),i._videoEl.src=e.item.src,i._videoEl.width=t._WIDTH,i._videoEl.height=t._HEIGHT,i._videoEl.addEventListener("ended",i.onVideoPlayFinished)):(t.loadedResourse.push(o),o=new createjs.Bitmap(e.item.src),"clearImg"==n?t.loadedBitmaps.clear=o:"fogImg"==n&&(t.loadedBitmaps.fog=o))},t.prototype._onFileLoadComplete=function(){t.stage.update();var e=t.main;e._loadQueue.removeEventListener("fileLoad",e._onFileLoad),e._loadQueue.removeEventListener("complete",e._onFileLoadComplete),e._loadQueue.removeEventListener("progress",e._onFileLoadProgress),e._loadQueue.removeEventListener("error",e._onFileLoadError),e.init(),e.addEventListener("boot",e._onBoot),e.dispatchEvent("boot")},t.prototype._onFileLoadProgress=function(){},t.prototype._onFileLoadError=function(){},t.prototype._onBoot=function(){var e=t.main;e.removeEventListener("boot",e._onBoot),e.addEventListener("gameStart",e._onGameStart),e.dispatchEvent("gameStart")},t.prototype._onGameStart=function(){var e=t.main,o=t.stage;e._mask.graphics,e.clearMask(),e.removeEventListener("gameStart",e._onGameStart),e._clear=new createjs.Container,t._isVideo?(e._clear.addChild(new createjs.Bitmap(e._videoEl)),e._videoEl.play(),createjs.Ticker.addEventListener("tick",e._onTick)):e._clear.addChild(t.loadedBitmaps.clear.clone()),o.addChild(e._clear),o.addChild(e._mask),e._mask.cache(0,0,t._WIDTH,t._HEIGHT),e._clear.cache(0,0,t._WIDTH,t._HEIGHT),o.update(),e._$canvas.on(t.mouseDown,{_main:e},e._onMouseDown)},t.prototype._onMouseDown=function(e){console.log(e.type),e.preventDefault();var o=t.main,n=t.stage,i=t.main._mask.graphics;o._lastX=n.mouseX,o._lastY=n.mouseY,i.beginFill(o._MASK_COLOR),i.drawCircle(o._lastX-2,o._lastY-2,2),o.drawMask(n.mouseX,n.mouseY),o._$canvas.on(t.mouseMove,{_main:o},o._onMouseMove),o._$canvas.on(t.mouseUp,{_main:o},o._onMouseUp)},t.prototype._onMouseMove=function(e){console.log(e.type);var o=t.stage;e.data._main.drawMask(o.mouseX,o.mouseY)},t.prototype._onMouseUp=function(e){e.preventDefault();var o=t.main,n=t.stage;o.drawMask(n.mouseX,n.mouseY),n.update(),o._$canvas.off(t.mouseMove,o._onMouseMove),o._$canvas.off(t.mouseUp,o._onMouseUp)},t.prototype._onMouseReave=function(e){e.preventDefault(),t.main.stopDraw()},t.prototype.onVideoPlayFinished=function(){t.main._videoEl.play()},t.prototype._onTick=function(){var e=t.main;t.stage,e._clear.updateCache(),t.stage.update()},t._isVideo=!0,t._WIDTH=960,t._HEIGHT=540,t.stage=new createjs.Stage("canvas"),t.loadedResourse=[],t.loadedBitmaps={},t.mouseDown="mousedown",t.mouseUp="mouseup",t.mouseMove="mousemove",t}(createjs.EventDispatcher);(function(){new Main})(jQuery);